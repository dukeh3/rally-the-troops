<%- include('header', { title: "Rally the Troops!", refresh: (active_games.length > 0 ? 300 : 0) }) %>
<img class="logo avatar" src="<%= avatar %>" width="80" height="80">
<p>
Welcome, <%= user.name %>!
<p>
Your mail address is <%= user.mail %>.

<br clear=left>

<p>&#xbb;
<%
	if (user.notify) {
		%><a href="/unsubscribe">Disable mail notifications</a><%
	} else {
		%><a href="/subscribe">Enable mail notifications</a><%
	}
%>
<br>&#xbb;
Change
<a href="/change_password">password</a>,
<a href="/change_mail">mail address</a>,
<a href="/change_name">name</a>,
or <a href="/change_about">profile text</a>.
<br>&#xbb;
<a href="/logout">Logout</a>

<% if (open_games.length > 0) { %>
<h2>Open Games</h2>
<table class="game">
<tr><th>ID<th>Game<th>Scenario<th>Players<th>Description<th>Created<th>
<% open_games.forEach((row) => { %>
<tr>
<td class="id"><%= row.game_id %>
<td class="name"><a href="/info/<%= row.title_id %>"><%= row.title_name %></a>
<td class="scenario"><%= row.scenario %>
<td class="players"><%- row.player_names %>
<td class="description"><%= row.description %>
<td class="time"><%= row.ctime %>
<td class="command"><a href="/join/<%= row.game_id %>">Join</a>
<% }); %>
</table>
<% } %>

<% if (active_games.length > 0) { %>
<h2>Active Games</h2>
<table class="game">
<tr><th>ID<th>Game<th>Scenario<th>Players<th>Description<th>Changed<th>Turn<th>
<% active_games.forEach((row) => { %>
<tr>
<td class="id"><%= row.game_id %>
<td class="title"><a href="/info/<%= row.title_id %>"><%= row.title_name %></a>
<td class="scenario"><%= row.scenario %>
<td class="players"><%- row.player_names %>
<td class="description"><%= row.description %>
<td class="time"><%= row.mtime %>
<%
	if (row.is_active) {
		%><td class="role is_active"><%= row.active %><%
	} else {
		%><td class="role"><%= row.active %><%
	}
	if (row.is_shared) {
		%><td class="command"><a href="/join/<%= row.game_id %>">Enter</a><%
	} else {
		%><td class="command"><a href="/play/<%= row.game_id %>">Play</a><%
	}
%>
<% }); %>
</table>
<% } %>

<% if (finished_games.length > 0) { %>
<h2>Finished Games</h2>
<table class="game">
<tr><th>ID<th>Game<th>Scenario<th>Players<th>Description<th>Finished<th>Result<th>
<% finished_games.forEach((row) => { %>
<tr>
<td class="id"><%= row.game_id %>
<td class="title"><a href="/info/<%= row.title_id %>"><%= row.title_name %></a>
<td class="scenario"><%= row.scenario %>
<td class="players"><%- row.player_names %>
<td class="description"><%= row.description %>
<td class="time"><%= row.mtime %>
<td class="result"><%= row.result %>
<td class="command"><a href="/join/<%= row.game_id %>">View</a>
<% }); %>
</table>
<% } %>

<% if (open_games.length === 0 && active_games.length === 0 && finished_games.length === 0) { %>
<p>
You don't have any current or finished games.
<% } %>
